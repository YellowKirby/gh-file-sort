<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
  </head>

  <body>
    <script type="module">
      import Popup from "./Popup.svelte";
      import browser from "webextension-polyfill";

      (async () => {
        const result = await browser.storage.sync.get("items");
        const popup = new Popup({
          target: document.body,
          props: {
            items: result.items,
          },
        });

        popup.$on("save", async (event) => {
          const { items } = event.detail;
          await browser.storage.sync.set({
            items,
          });

          const [tab] = await browser.tabs.query({
            active: true,
            lastFocusedWindow: true,
          });
          if (tab) {
            await browser.tabs.sendMessage(tab.id, {
              items,
            });
          }
        });
      })();
    </script>
  </body>
</html>
